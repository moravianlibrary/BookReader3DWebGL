/** http://github.com/foo123/MOD3
**
** AS3Mod port to javascript by Nikos M.
** http://nikos-web-development-netai.net/
**/
var MOD3=MOD3||{};MOD3.ModConstant={LEFT:-1,RIGHT:1,NONE:0,X:1,Y:2,Z:4};MOD3.XMath={};MOD3.XMath.normalize=function(a,b,c){return b-a==0?1:MOD3.XMath.trim(0,1,(c-a)/b)};MOD3.XMath.toRange=function(a,b,c){return b-a==0?0:a+(b-a)*c};MOD3.XMath.inInRange=function(a,b,c,d){typeof d=="undefined"&&(d=!1);return d?c>=a&&c<=b:c>a&&c<b};MOD3.XMath.sign=function(a,b){typeof b=="undefined"&&(b=0);return a==0?b:a>0?1:-1};MOD3.XMath.trim=function(a,b,c){return Math.min(b,Math.max(a,c))};
MOD3.XMath.wrap=function(a,b,c){return c<a?c+(b-a):c>=b?c-(b-a):c};MOD3.XMath.degToRad=function(a){return a/180*Math.PI};MOD3.XMath.radToDeg=function(a){return a/Math.PI*180};MOD3.XMath.presicion=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c};MOD3.XMath.uceil=function(a){return a<0?Math.floor(a):Math.ceil(a)};MOD3.Range=function(a,b){this.start=0;this.end=1;if(typeof a!="undefined")this.start=a;if(typeof b!="undefined")this.end=b};
MOD3.Range.prototype.getSize=function(){return this.end-this.start};MOD3.Range.prototype.move=function(a){this.start+=a;this.end+=a};MOD3.Range.prototype.isIn=function(a){return a>=this.start&&a<=this.end};MOD3.Range.prototype.normalize=function(a){return MOD3.XMath.normalize(this.start,this.end,a)};MOD3.Range.prototype.toRange=function(a){return MOD3.XMath.toRange(this.start,this.end,a)};MOD3.Range.prototype.trim=function(a){return MOD3.XMath.trim(this.start,this.end,a)};
MOD3.Range.prototype.interpolate=function(a,b){return this.toRange(b.normalize(a))};MOD3.Range.prototype.toString=function(){return"["+this.start+" - "+this.end+"]"};MOD3.Phase=function(a){this.value=0;if(typeof a!="undefined")this.value=a};MOD3.Phase.prototype.getPhasedValue=function(){return Math.sin(this.value)};MOD3.Phase.prototype.getAbsPhasedValue=function(){return Math.abs(this.getPhasedValue())};MOD3.Phase.prototype.getNormValue=function(){return(this.getPhasedValue()+1)*0.5};
MOD3.Point=function(a,b){this.y=this.x=0;if(typeof a!="undefined")this.x=a;if(typeof b!="undefined")this.y=b};MOD3.Point.prototype.clone=function(){return new MOD3.Point(this.x,this.y)};MOD3.Matrix=function(a,b,c,d){this.m11=1;this.m21=this.m12=0;this.m22=1;if(typeof a!="undefined")this.m11=a;if(typeof b!="undefined")this.m12=b;if(typeof c!="undefined")this.m21=c;if(typeof d!="undefined")this.m22=d};
MOD3.Matrix.prototype.rotate=function(a){var b=Math.cos(a),a=Math.sin(a);this.m11=b;this.m12=-a;this.m21=a;this.m22=b;return this};MOD3.Matrix.prototype.scale=function(a,b){this.m21=this.m12=0;if(typeof a!="undefined")this.m22=this.m11=a;if(typeof b!="undefined")this.m22=b;return this};
MOD3.Matrix.prototype.multiply=function(a){var b=this.m11*a.m12+this.m12*a.m22,c=this.m21*a.m11+this.m22*a.m21,d=this.m21*a.m12+this.m22*a.m22;this.m11=this.m11*a.m11+this.m12*a.m21;this.m12=b;this.m21=c;this.m22=d;return this};MOD3.Matrix.prototype.transformPoint=function(a){return new MOD3.Point(this.m11*a.x+this.m12*a.y,this.m21*a.x+this.m22*a.y)};MOD3.Vector3=function(a,b,c){this.z=this.y=this.x=null;this.x=a;this.y=b;this.z=c};MOD3.Vector3.ZERO=function(){return new MOD3.Vector3(0,0,0)};
MOD3.Vector3.prototype.clone=function(){return new MOD3.Vector3(this.x,this.y,this.z)};MOD3.Vector3.prototype.equals=function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z};MOD3.Vector3.prototype.zero=function(){this.x=this.y=this.z=0};MOD3.Vector3.prototype.negate=function(){return new MOD3.Vector3(-this.x,-this.y,-this.z)};MOD3.Vector3.prototype.add=function(a){return new MOD3.Vector3(this.x+a.x,this.y+a.y,this.z+a.z)};
MOD3.Vector3.prototype.subtract=function(a){return new MOD3.Vector3(this.x-a.x,this.y-a.y,this.z-a.z)};MOD3.Vector3.prototype.multiplyScalar=function(a){return new MOD3.Vector3(this.x*a,this.y*a,this.z*a)};MOD3.Vector3.prototype.multiply=function(a){return new MOD3.Vector3(this.x*a.x,this.y*a.y,this.z*a.z)};MOD3.Vector3.prototype.divide=function(a){a=1/a;return new MOD3.Vector3(this.x*a,this.y*a,this.z*a)};
MOD3.Vector3.prototype.normalize=function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;a>0&&(a=1/Math.sqrt(a),this.x*=a,this.y*=a,this.z*=a)};MOD3.Vector3.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};MOD3.Vector3.prototype.setMagnitude=function(a){this.normalize();this.x*=a;this.y*=a;this.z*=a};MOD3.Vector3.prototype.toString=function(){return"["+this.x+" , "+this.y+" , "+this.z+"]"};MOD3.Vector3.prototype.sum=function(a,b){return a.add(b)};
MOD3.Vector3.prototype.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};MOD3.Vector3.prototype.cross=function(a,b){return new MOD3.Vector3(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x)};MOD3.Vector3.prototype.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y,f=a.z-b.z;return Math.sqrt(c*c+d*d+f*f)};
MOD3.Matrix4=function(a,b,c,d,f,e,g,i,h,k,j,n,l,o,m,p){this.n11=1;this.n21=this.n14=this.n13=this.n12=0;this.n22=1;this.n32=this.n31=this.n24=this.n23=0;this.n33=1;this.n43=this.n42=this.n41=this.n34=0;this.n44=1;if(typeof a!="undefined")this.n11=a;if(typeof b!="undefined")this.n12=b;if(typeof c!="undefined")this.n13=c;if(typeof d!="undefined")this.n14=d;if(typeof f!="undefined")this.n21=f;if(typeof e!="undefined")this.n22=e;if(typeof g!="undefined")this.n23=g;if(typeof i!="undefined")this.n24=i;
if(typeof h!="undefined")this.n31=h;if(typeof k!="undefined")this.n32=k;if(typeof j!="undefined")this.n33=j;if(typeof n!="undefined")this.n34=n;if(typeof l!="undefined")this.n41=l;if(typeof o!="undefined")this.n42=o;if(typeof m!="undefined")this.n43=m;if(typeof p!="undefined")this.n44=p};MOD3.Matrix4.prototype.translationMatrix=function(a,b,c){this.n14=a;this.n24=b;this.n34=c;return this};MOD3.Matrix4.prototype.scaleMatrix=function(a,b,c){this.n11=a;this.n22=b;this.n33=c;return this};
MOD3.Matrix4.prototype.rotationMatrix=function(a,b,c,d){var f=Math.cos(d),e=Math.sin(d),d=1-f,g=a*b*d,i=b*c*d,h=a*c*d,k=e*c,j=e*b;e*=a;this.n11=f+a*a*d;this.n12=-k+g;this.n13=j+h;this.n14=0;this.n21=k+g;this.n22=f+b*b*d;this.n23=-e+i;this.n24=0;this.n31=-j+h;this.n32=e+i;this.n33=f+c*c*d;this.n34=0;return this};
MOD3.Matrix4.prototype.calculateMultiply=function(a,b){var c=a.n11,d=b.n11,f=a.n21,e=b.n21,g=a.n31,i=b.n31,h=a.n12,k=b.n12,j=a.n22,n=b.n22,l=a.n32,o=b.n32,m=a.n13,p=b.n13,q=a.n23,s=b.n23,r=a.n33,t=b.n33,x=a.n14,u=b.n14,y=a.n24,v=b.n24,z=a.n34,w=b.n34;this.n11=c*d+h*e+m*i;this.n12=c*k+h*n+m*o;this.n13=c*p+h*s+m*t;this.n14=c*u+h*v+m*w+x;this.n21=f*d+j*e+q*i;this.n22=f*k+j*n+q*o;this.n23=f*p+j*s+q*t;this.n24=f*u+j*v+q*w+y;this.n31=g*d+l*e+r*i;this.n32=g*k+l*n+r*o;this.n33=g*p+l*s+r*t;this.n34=g*u+l*
v+r*w+z};MOD3.Matrix4.prototype.multiply=function(a,b){this.calculateMultiply(a,b);return this};MOD3.Matrix4.prototype.multiplyVector=function(a,b){var c=b.x,d=b.y,f=b.z;b.x=c*a.n11+d*a.n12+f*a.n13+a.n14;b.y=c*a.n21+d*a.n22+f*a.n23+a.n24;b.z=c*a.n31+d*a.n32+f*a.n33+a.n34};MOD3.VertexProxy=function(a){this.originalZ=this.originalY=this.originalX=this.ratioZ=this.ratioY=this.ratioX=null;if(typeof a!="undefined")this.vertex=a};MOD3.VertexProxy.prototype.setVertex=function(){};
MOD3.VertexProxy.prototype.setRatios=function(a,b,c){this.ratioX=a;this.ratioY=b;this.ratioZ=c};MOD3.VertexProxy.prototype.setOriginalPosition=function(a,b,c){this.originalX=a;this.originalY=b;this.originalZ=c};MOD3.VertexProxy.prototype.getX=function(){};MOD3.VertexProxy.prototype.getY=function(){};MOD3.VertexProxy.prototype.getZ=function(){};MOD3.VertexProxy.prototype.setX=function(){};MOD3.VertexProxy.prototype.setY=function(){};MOD3.VertexProxy.prototype.setZ=function(){};
MOD3.VertexProxy.prototype.getValue=function(a){switch(a){case MOD3.ModConstant.X:return this.getX();case MOD3.ModConstant.Y:return this.getY();case MOD3.ModConstant.Z:return this.getZ()}return 0};MOD3.VertexProxy.prototype.setValue=function(a,b){switch(a){case MOD3.ModConstant.X:this.setX(b);break;case MOD3.ModConstant.Y:this.setY(b);break;case MOD3.ModConstant.Z:this.setZ(b)}};
MOD3.VertexProxy.prototype.getRatio=function(a){switch(a){case MOD3.ModConstant.X:return this.ratioX;case MOD3.ModConstant.Y:return this.ratioY;case MOD3.ModConstant.Z:return this.ratioZ}return-1};MOD3.VertexProxy.prototype.getOriginalValue=function(a){switch(a){case MOD3.ModConstant.X:return this.originalX;case MOD3.ModConstant.Y:return this.originalY;case MOD3.ModConstant.Z:return this.originalZ}return 0};
MOD3.VertexProxy.prototype.reset=function(){this.setX(this.originalX);this.setY(this.originalY);this.setZ(this.originalZ)};MOD3.VertexProxy.prototype.collapse=function(){this.originalX=this.getX();this.originalY=this.getY();this.originalZ=this.getZ()};MOD3.VertexProxy.prototype.getVector=function(){return new MOD3.Vector3(this.getX(),this.getY(),this.getZ())};MOD3.VertexProxy.prototype.setVector=function(a){this.setX(a.x);this.setY(a.y);this.setZ(a.z)};
MOD3.VertexProxy.prototype.getRatioVector=function(){return new MOD3.Vector3(this.ratioX,this.ratioY,this.ratioZ)};MOD3.FaceProxy=function(){this.vertices=[]};MOD3.FaceProxy.prototype.addVertex=function(a){this.vertices.push(a)};MOD3.FaceProxy.prototype.getVertices=function(){return this.vertices};
MOD3.MeshProxy=function(){this.depth=this.height=this.width=this.minAxis=this.midAxis=this.maxAxis=this.minZ=this.minY=this.minX=this.maxZ=this.maxY=this.maxX=this.faces=this.vertices=null;this.vertices=[];this.faces=[];this.mesh=null};MOD3.MeshProxy.prototype.getVertices=function(){return this.vertices};MOD3.MeshProxy.prototype.getFaces=function(){return this.faces};
MOD3.MeshProxy.prototype.analyzeGeometry=function(){var a=this.getVertices().length,b,c;for(b=0;b<a;b++)c=this.getVertices()[b],b==0?(this.minX=this.maxX=c.getX(),this.minY=this.maxY=c.getY(),this.minZ=this.maxZ=c.getZ()):(this.minX=Math.min(this.minX,c.getX()),this.minY=Math.min(this.minY,c.getY()),this.minZ=Math.min(this.minZ,c.getZ()),this.maxX=Math.max(this.maxX,c.getX()),this.maxY=Math.max(this.maxY,c.getY()),this.maxZ=Math.max(this.maxZ,c.getZ())),c.setOriginalPosition(c.getX(),c.getY(),c.getZ());
this.width=this.maxX-this.minX;this.height=this.maxY-this.minY;this.depth=this.maxZ-this.minZ;b=Math.max(this.width,Math.max(this.height,this.depth));c=Math.min(this.width,Math.min(this.height,this.depth));if(b==this.width&&c==this.height)this.minAxis=MOD3.ModConstant.Y,this.midAxis=MOD3.ModConstant.Z,this.maxAxis=MOD3.ModConstant.X;else if(b==this.width&&c==this.depth)this.minAxis=MOD3.ModConstant.Z,this.midAxis=MOD3.ModConstant.Y,this.maxAxis=MOD3.ModConstant.X;else if(b==this.height&&c==this.width)this.minAxis=
MOD3.ModConstant.X,this.midAxis=MOD3.ModConstant.Z,this.maxAxis=MOD3.ModConstant.Y;else if(b==this.height&&c==this.depth)this.minAxis=MOD3.ModConstant.Z,this.midAxis=MOD3.ModConstant.X,this.maxAxis=MOD3.ModConstant.Y;else if(b==this.depth&&c==this.width)this.minAxis=MOD3.ModConstant.X,this.midAxis=MOD3.ModConstant.Y,this.maxAxis=MOD3.ModConstant.Z;else if(b==this.depth&&c==this.height)this.minAxis=MOD3.ModConstant.Y,this.midAxis=MOD3.ModConstant.X,this.maxAxis=MOD3.ModConstant.Z;for(b=0;b<a;b++)c=
this.getVertices()[b],c.setRatios((c.getX()-this.minX)/this.width,(c.getY()-this.minY)/this.height,(c.getZ()-this.minZ)/this.depth)};MOD3.MeshProxy.prototype.resetGeometry=function(){for(var a=this.getVertices().length,b=0;b<a;b++)this.getVertices()[b].reset()};MOD3.MeshProxy.prototype.collapseGeometry=function(){for(var a=this.getVertices().length,b=0;b<a;b++)this.getVertices()[b].collapse();this.analyzeGeometry()};
MOD3.MeshProxy.prototype.getMin=function(a){switch(a){case MOD3.ModConstant.X:return this.minX;case MOD3.ModConstant.Y:return this.minY;case MOD3.ModConstant.Z:return this.minZ}return-1};MOD3.MeshProxy.prototype.getMax=function(a){switch(a){case MOD3.ModConstant.X:return this.maxX;case MOD3.ModConstant.Y:return this.maxY;case MOD3.ModConstant.Z:return this.maxZ}return-1};
MOD3.MeshProxy.prototype.getSize=function(a){switch(a){case MOD3.ModConstant.X:return this.width;case MOD3.ModConstant.Y:return this.height;case MOD3.ModConstant.Z:return this.depth}return-1};MOD3.MeshProxy.prototype.setMesh=function(a){this.mesh=a;this.vertices=[];this.faces=[]};MOD3.MeshProxy.prototype.postApply=function(){};MOD3.MeshProxy.prototype.updateMeshPosition=function(){};MOD3.Modifier=function(){this.mod=null};MOD3.Modifier.prototype.setModifiable=function(a){this.mod=a};
MOD3.Modifier.prototype.getVertices=function(){return this.mod.getVertices()};MOD3.Modifier.prototype.apply=function(){};MOD3.Library3d=function(){this.id="";this.vertexClass=this.meshClass=null};MOD3.PluginFactory={};MOD3.PluginFactory.getMeshProxy=function(a){return new a.meshClass};MOD3.ModifierStack=function(a,b){this.lib3d=a;this.stack=this.baseMesh=null;this.baseMesh=MOD3.PluginFactory.getMeshProxy(a);this.baseMesh.setMesh(b);this.baseMesh.analyzeGeometry();this.stack=[]};
MOD3.ModifierStack.prototype.addModifier=function(a){a.setModifiable(this.baseMesh);this.stack.push(a)};MOD3.ModifierStack.prototype.apply=function(){this.baseMesh.resetGeometry();for(var a=0;a<this.stack.length;a++)this.stack[a].apply();this.baseMesh.postApply()};MOD3.ModifierStack.prototype.collapse=function(){this.apply();this.baseMesh.collapseGeometry();this.stack=[]};MOD3.ModifierStack.prototype.clear=function(){this.stack=[]};MOD3.ModifierStack.prototype.getMeshInfo=function(){return this.baseMesh};
MOD3.Pivot=function(a,b,c){this.pivot=null;this.pivot=new MOD3.Vector3(a,b,c)};MOD3.Pivot.prototype=new MOD3.Modifier;MOD3.Pivot.prototype.constructor=MOD3.Pivot;MOD3.Pivot.prototype.setMeshCenter=function(){this.pivot=new MOD3.Vector3(-(this.mod.minX+this.mod.width/2),-(this.mod.minY+this.mod.height/2),-(this.mod.minZ+this.mod.depth/2))};MOD3.Pivot.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,c=0;c<b;c++){var d=a[c],f=d.getVector().clone();d.setVector(f.add(this.pivot))}this.mod.updateMeshPosition(this.pivot.clone().negate())};
MOD3.Bend=function(a,b,c){this.diagAngle=this.angle=this.offset=this.force=null;this.constraint=MOD3.ModConstant.NONE;this.m2=this.m1=this.origin=this.height=this.width=this.mid=this.min=this.max=null;this.switchAxes=!1;this.force=a;this.offset=b;this.setAngle(c)};MOD3.Bend.prototype=new MOD3.Modifier;MOD3.Bend.prototype.constructor=MOD3.Bend;MOD3.Bend.prototype.setAngle=function(a){this.angle=a;this.m1=new MOD3.Matrix;this.m1.rotate(this.angle);this.m2=new MOD3.Matrix;this.m2.rotate(-this.angle)};
MOD3.Bend.prototype.setModifiable=function(a){MOD3.Modifier.prototype.setModifiable.call(this,a);this.max=this.switchAxes?this.mod.midAxis:this.mod.maxAxis;this.min=this.mod.minAxis;this.mid=this.switchAxes?this.mod.maxAxis:this.mod.midAxis;this.width=this.mod.getSize(this.max);this.height=this.mod.getSize(this.mid);this.origin=this.mod.getMin(this.max);this.diagAngle=Math.atan(this.width/this.height)};
MOD3.Bend.prototype.apply=function(){if(this.force!=0)for(var a=this.mod.getVertices(),b=a.length,c=this.origin+this.width*this.offset,d=this.width/Math.PI/this.force,f=Math.PI*2*(this.width/(d*Math.PI*2)),e=0;e<b;e++){var g=a[e],i=g.getValue(this.max),h=g.getValue(this.mid),k=g.getValue(this.min),h=this.m1.transformPoint(new MOD3.Point(i,h)),i=h.x,h=h.y,j=(i-this.origin)/this.width;this.constraint==MOD3.ModConstant.LEFT&&j<=this.offset||this.constraint==MOD3.ModConstant.RIGHT&&j>=this.offset||(i=
Math.PI/2-f*this.offset+f*j,j=Math.cos(i)*(d+k),k=Math.sin(i)*(d+k)-d,i=c-j);h=this.m2.transformPoint(new MOD3.Point(i,h));i=h.x;h=h.y;g.setValue(this.max,i);g.setValue(this.mid,h);g.setValue(this.min,k)}};MOD3.Bloat=function(){this.center=MOD3.Vector3.ZERO();this.radius=0;this.a=0.01;this.u=MOD3.Vector3.ZERO()};MOD3.Bloat.prototype=new MOD3.Modifier;MOD3.Bloat.prototype.constructor=MOD3.Bloat;MOD3.Bloat.prototype.setRadius=function(a){this.radius=Math.max(0,a)};
MOD3.Bloat.prototype.setA=function(a){this.a=Math.max(0,a)};MOD3.Bloat.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,c,d=0;d<b;d++)c=a[d],this.u.x=c.getX()-this.center.x,this.u.y=c.getY()-this.center.y,this.u.z=c.getZ()-this.center.z,this.u.setMagnitude(this.u.getMagnitude()+this.radius*Math.exp(-this.u.getMagnitude()*this.a)),c.setX(this.u.x+this.center.x),c.setY(this.u.y+this.center.y),c.setZ(this.u.z+this.center.z)};
MOD3.Twist=function(a){this.vector=new MOD3.Vector3(0,1,0);this.angle=a;this.center=MOD3.Vector3.ZERO()};MOD3.Twist.prototype=new MOD3.Modifier;MOD3.Twist.prototype.constructor=MOD3.Twist;
MOD3.Twist.prototype.apply=function(){this.vector.normalize();for(var a=new MOD3.Vector3(this.mod.maxX/2,this.mod.maxY/2,this.mod.maxZ/2),b=-MOD3.Vector3.prototype.dot.call(this,this.vector,this.center),c=0;c<this.mod.getVertices().length;c++){var d=this.mod.getVertices()[c],f=MOD3.Vector3.prototype.dot.call(this,new MOD3.Vector3(d.getX(),d.getY(),d.getZ()),this.vector)+b;this.twistPoint(d,f/a.getMagnitude()*this.angle)}};
MOD3.Twist.prototype.twistPoint=function(a,b){var c=(new MOD3.Matrix4).translationMatrix(a.getX(),a.getY(),a.getZ()),c=(new MOD3.Matrix4).multiply((new MOD3.Matrix4).rotationMatrix(this.vector.x,this.vector.y,this.vector.z,b),c);a.setX(c.n14);a.setY(c.n24);a.setZ(c.n34)};MOD3.Skew=function(a){this.force=0;this.skewAxis=null;if(typeof a!="undefined")this.force=a;this.offset=0.5;this.constraint=MOD3.ModConstant.NONE;this.falloff=this.power=1;this.swapAxes=this.oneSide=this.inverseFalloff=!1};
MOD3.Skew.prototype=new MOD3.Modifier;MOD3.Skew.prototype.constructor=MOD3.Skew;MOD3.Skew.prototype.setModifiable=function(a){MOD3.Modifier.prototype.setModifiable.call(this,a);this.skewAxis=this.skewAxis||this.mod.maxAxis};
MOD3.Skew.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,c=0;c<b;c++){var d=a[c];if(!(this.constraint==MOD3.ModConstant.LEFT&&d.getRatio(this.skewAxis)<=this.offset)&&!(this.constraint==MOD3.ModConstant.RIGHT&&d.getRatio(this.skewAxis)>this.offset)){var f=d.getRatio(this.skewAxis)-this.offset;this.oneSide&&(f=Math.abs(f));var e=d.getRatio(this.getDisplaceAxis());this.inverseFalloff&&(e=1-e);e=this.falloff+e*(1-this.falloff);f=Math.pow(Math.abs(f),this.power)*MOD3.XMath.sign(f,
1);f=d.getValue(this.getDisplaceAxis())+this.force*f*e;d.setValue(this.getDisplaceAxis(),f)}}};MOD3.Skew.prototype.getDisplaceAxis=function(){switch(this.skewAxis){case MOD3.ModConstant.X:return this.swapAxes?MOD3.ModConstant.Z:MOD3.ModConstant.Y;case MOD3.ModConstant.Y:return this.swapAxes?MOD3.ModConstant.Z:MOD3.ModConstant.X;case MOD3.ModConstant.Z:return this.swapAxes?MOD3.ModConstant.Y:MOD3.ModConstant.X;default:return 0}};
MOD3.Taper=function(a){this.power=this.force=null;this.start=0;this.end=1;this.vector=new MOD3.Vector3(1,0,1);this.vector2=new MOD3.Vector3(0,1,0);if(typeof a!="undefined")this.force=a;this.power=1};MOD3.Taper.prototype=new MOD3.Modifier;MOD3.Taper.prototype.constructor=MOD3.Taper;MOD3.Taper.prototype.setFalloff=function(a,b){this.start=0;this.end=1;if(typeof a!="undefined")this.start=a;if(typeof b!="undefined")this.end=b};
MOD3.Taper.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,c=0;c<b;c++){var d=a[c],f=d.getRatioVector().multiply(this.vector2),f=this.force*Math.pow(f.getMagnitude(),this.power),f=(new MOD3.Matrix4).scaleMatrix(1+f*this.vector.x,1+f*this.vector.y,1+f*this.vector.z),e=d.getVector();(new MOD3.Matrix4).multiplyVector(f,e);d.setVector(e)}};
MOD3.Wheel=function(){this.radius=this.roll=this.turn=this.speed=null;this.steerVector=new MOD3.Vector3(0,1,0);this.rollVector=new MOD3.Vector3(0,0,1);this.roll=this.turn=this.speed=0};MOD3.Wheel.prototype=new MOD3.Modifier;MOD3.Wheel.prototype.constructor=MOD3.Wheel;MOD3.Wheel.prototype.setModifiable=function(a){MOD3.Modifier.prototype.setModifiable.call(this,a);this.radius=this.mod.width/2};
MOD3.Wheel.prototype.apply=function(){this.roll+=this.speed;var a=this.mod.getVertices(),b=a.length,c;if(this.turn!=0){var d=(new MOD3.Matrix4).rotationMatrix(this.steerVector.x,this.steerVector.y,this.steerVector.z,this.turn);c=this.rollVector.clone();(new MOD3.Matrix4).multiplyVector(d,c);c=(new MOD3.Matrix4).rotationMatrix(c.x,c.y,c.z,this.roll)}else c=(new MOD3.Matrix4).rotationMatrix(this.rollVector.x,this.rollVector.y,this.rollVector.z,this.roll);for(var f=0;f<b;f++){var e=a[f],g=e.getVector().clone();
this.turn!=0&&(new MOD3.Matrix4).multiplyVector(d,g);(new MOD3.Matrix4).multiplyVector(c,g);e.setX(g.x);e.setY(g.y);e.setZ(g.z)}};MOD3.Wheel.prototype.getStep=function(){return this.radius*this.speed/Math.PI};MOD3.Wheel.prototype.getPerimeter=function(){return this.radius*2*Math.PI};MOD3.Break=function(a,b){this.bv=new MOD3.Vector3(0,1,0);this.angle=this.offset=0;if(typeof a!="undefined")this.offset=a;if(typeof b!="undefined")this.angle=b;this.range=new MOD3.Range(0,1)};MOD3.Break.prototype=new MOD3.Modifier;
MOD3.Break.prototype.constructor=MOD3.Break;MOD3.Break.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,c=new MOD3.Vector3(0,0,-(this.mod.minZ+this.mod.depth*this.offset)),d=0;d<b;d++){var f=a[d],e=f.getVector(),e=e.add(c);if(e.z>=0&&this.range.isIn(f.ratioY)){var g=this.angle,g=(new MOD3.Matrix4).rotationMatrix(this.bv.x,this.bv.y,this.bv.z,g);(new MOD3.Matrix4).multiplyVector(g,e)}g=c.negate();e=e.add(g);f.setX(e.x);f.setY(e.y);f.setZ(e.z)}};
MOD3.Noise=function(a){this.force=0;this.axc=MOD3.ModConstant.NONE;this.end=this.start=0;if(typeof a!="undefined")this.force=a};MOD3.Noise.prototype=new MOD3.Modifier;MOD3.Noise.prototype.constructor=MOD3.Noise;MOD3.Noise.prototype.constraintAxes=function(a){this.axc=a};MOD3.Noise.prototype.setFalloff=function(a,b){this.start=0;this.end=1;if(typeof a!="undefined")this.start=a;if(typeof b!="undefined")this.end=b};
MOD3.Noise.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,c=0;c<b;c++){var d=a[c],f=Math.random()*this.force-this.force/2,e=d.getRatio(this.mod.maxAxis);this.start<this.end?(e<this.start&&(e=0),e>this.end&&(e=1)):this.start>this.end?(e=1-e,e>this.start&&(e=0),e<this.end&&(e=1)):e=1;this.axc&1||d.setX(d.getX()+f*e);this.axc>>1&1||d.setY(d.getY()+f*e);this.axc>>2&1||d.setZ(d.getZ()+f*e)}};
MOD3.LibraryThree=function(){this.id="Three.js";this.meshClass=MOD3.MeshThree;this.vertexClass=MOD3.VertexThree};MOD3.LibraryThree.prototype=new MOD3.Library3d;MOD3.LibraryThree.prototype.constructor=MOD3.LibraryThree;MOD3.VertexThree=function(a){this.mesh=a};MOD3.VertexThree.prototype=new MOD3.VertexProxy;MOD3.VertexThree.prototype.setVertex=function(a){this.vertex=a;this.originalX=a.position.x;this.originalY=a.position.y;this.originalZ=a.position.z};MOD3.VertexThree.prototype.getX=function(){return this.vertex.position.x};
MOD3.VertexThree.prototype.getY=function(){return this.vertex.position.y};MOD3.VertexThree.prototype.getZ=function(){return this.vertex.position.z};MOD3.VertexThree.prototype.setX=function(a){this.vertex.position.x=a;this.mesh.geometry.__dirtyVertices=!0;this.mesh.geometry.__dirtyNormals=!0;this.mesh.geometry.dynamic=!0};MOD3.VertexThree.prototype.setY=function(a){this.vertex.position.y=a;this.mesh.geometry.__dirtyVertices=!0;this.mesh.geometry.__dirtyNormals=!0;this.mesh.geometry.dynamic=!0};
MOD3.VertexThree.prototype.setZ=function(a){this.vertex.position.z=a;this.mesh.geometry.__dirtyVertices=!0;this.mesh.geometry.__dirtyNormals=!0;this.mesh.geometry.dynamic=!0};MOD3.MeshThree=function(){};MOD3.MeshThree.prototype=new MOD3.MeshProxy;
MOD3.MeshThree.prototype.setMesh=function(a){MOD3.MeshProxy.prototype.setMesh.call(this,a);for(var a=[],b=this.mesh.geometry.vertices,c=this.mesh.geometry.faces,d=b.length,f=c.length,e=0;e<d;e++){var g=new MOD3.VertexThree(this.mesh);g.setVertex(b[e]);this.vertices.push(g);a[b[e]]=g}for(e=0;e<f;e++)d=new MOD3.FaceProxy,c[e]instanceof THREE.Face3?(d.addVertex(a[b[c[e].a]]),d.addVertex(a[b[c[e].b]]),d.addVertex(a[b[c[e].c]])):c[e]instanceof THREE.Face4&&(d.addVertex(a[b[c[e].a]]),d.addVertex(a[b[c[e].b]]),
d.addVertex(a[b[c[e].c]]),d.addVertex(a[b[c[e].d]])),this.faces.push(d);delete lookup};MOD3.MeshThree.prototype.updateMeshPosition=function(a){this.mesh.position.x+=a.x;this.mesh.position.y+=a.y;this.mesh.position.z+=a.z};MOD3.LibraryPre3D=function(){this.id="pre3d.js";this.meshClass=MOD3.MeshPre3D;this.vertexClass=MOD3.VertexPre3D};MOD3.LibraryThree.prototype=new MOD3.Library3d;MOD3.LibraryThree.prototype.constructor=MOD3.LibraryPre3D;MOD3.VertexPre3D=function(){};MOD3.VertexPre3D.prototype=new MOD3.VertexProxy;
MOD3.VertexPre3D.prototype.setVertex=function(a){this.vertex=a;this.originalX=a.x;this.originalY=a.y;this.originalZ=a.z};MOD3.VertexPre3D.prototype.getX=function(){return this.vertex.x};MOD3.VertexPre3D.prototype.getY=function(){return this.vertex.y};MOD3.VertexPre3D.prototype.getZ=function(){return this.vertex.z};MOD3.VertexPre3D.prototype.setX=function(a){this.vertex.x=a};MOD3.VertexPre3D.prototype.setY=function(a){this.vertex.y=a};MOD3.VertexPre3D.prototype.setZ=function(a){this.vertex.z=a};
MOD3.MeshPre3D=function(){};MOD3.MeshPre3D.prototype=new MOD3.MeshProxy;
MOD3.MeshPre3D.prototype.setMesh=function(a){MOD3.MeshProxy.prototype.setMesh.call(this,a);for(var a=[],b=this.mesh.vertices,c=this.mesh.quads,d=b.length,f=c.length,e=0;e<d;e++){var g=new MOD3.VertexPre3D;g.setVertex(b[e]);this.vertices.push(g);a[b[e]]=g}for(e=0;e<f;e++)d=new MOD3.FaceProxy,c[e]instanceof Pre3d.QuadFace&&(d.addVertex(a[b[c[e].i0]]),d.addVertex(a[b[c[e].i1]]),d.addVertex(a[b[c[e].i2]]),c[e].i3!=null&&d.addVertex(a[b[c[e].i3]])),this.faces.push(d);delete lookup};
MOD3.MeshPre3D.prototype.updateMeshPosition=function(){};MOD3.LibraryJ3D=function(){this.id="J3D";this.meshClass=MOD3.MeshJ3D;this.vertexClass=MOD3.VertexJ3D};MOD3.LibraryJ3D.prototype=new MOD3.Library3d;MOD3.LibraryJ3D.prototype.constructor=MOD3.LibraryJ3D;MOD3.VertexJ3D=function(a){this.geometry=a};MOD3.VertexJ3D.prototype=new MOD3.VertexProxy;
MOD3.VertexJ3D.prototype.setVertex=function(a){this.vertex=a;this.originalX=this.geometry.vertexPositionBuffer.data[this.vertex];this.originalY=this.geometry.vertexPositionBuffer.data[this.vertex+1];this.originalZ=this.geometry.vertexPositionBuffer.data[this.vertex+2]};MOD3.VertexJ3D.prototype.getX=function(){return this.geometry.vertexPositionBuffer.data[this.vertex]};MOD3.VertexJ3D.prototype.getY=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+1]};
MOD3.VertexJ3D.prototype.getZ=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+2]};MOD3.VertexJ3D.prototype.setX=function(a){this.geometry.vertexPositionBuffer.data[this.vertex]=a;this.geometry.replaceArray(this.geometry.vertexPositionBuffer,this.geometry.vertexPositionBuffer.data)};MOD3.VertexJ3D.prototype.setY=function(a){this.geometry.vertexPositionBuffer.data[this.vertex+1]=a;this.geometry.replaceArray(this.geometry.vertexPositionBuffer,this.geometry.vertexPositionBuffer.data)};
MOD3.VertexJ3D.prototype.setZ=function(a){this.geometry.vertexPositionBuffer.data[this.vertex+2]=a;this.geometry.replaceArray(this.geometry.vertexPositionBuffer,this.geometry.vertexPositionBuffer.data)};MOD3.MeshJ3D=function(){};MOD3.MeshJ3D.prototype=new MOD3.MeshProxy;
MOD3.MeshJ3D.prototype.setMesh=function(a){MOD3.MeshProxy.prototype.setMesh.call(this,a);for(var a=this.mesh.geometry.vertexPositionBuffer.itemSize,b=this.mesh.geometry.vertexPositionBuffer.data.length,c=0;c<b;c+=a){var d=new MOD3.VertexJ3D(this.mesh.geometry);d.setVertex(c);this.vertices.push(d)}this.faces=null;delete lookup};MOD3.MeshJ3D.prototype.updateMeshPosition=function(a){this.mesh.position.x+=a.x;this.mesh.position.y+=a.y;this.mesh.position.z+=a.z};
MOD3.LibraryCopperlicht=function(){this.id="Copperlicht";this.meshClass=MOD3.MeshCopperlicht;this.vertexClass=MOD3.VertexCopperlicht};MOD3.LibraryCopperlicht.prototype=new MOD3.Library3d;MOD3.LibraryCopperlicht.prototype.constructor=MOD3.LibraryCopperlicht;MOD3.VertexCopperlicht=function(a,b){this.node=a;this.buffer=b};MOD3.VertexCopperlicht.prototype=new MOD3.VertexProxy;
MOD3.VertexCopperlicht.prototype.setVertex=function(a){this.vertex=a;this.originalX=this.vertex.Pos.X;this.originalY=this.vertex.Pos.Y;this.originalZ=this.vertex.Pos.Z};MOD3.VertexCopperlicht.prototype.getX=function(){return this.vertex.Pos.X};MOD3.VertexCopperlicht.prototype.getY=function(){return this.vertex.Pos.Y};MOD3.VertexCopperlicht.prototype.getZ=function(){return this.vertex.Pos.Z};MOD3.VertexCopperlicht.prototype.setX=function(a){this.vertex.Pos.X=a;this.buffer.update(!0)};
MOD3.VertexCopperlicht.prototype.setY=function(a){this.vertex.Pos.Y=a;this.buffer.update(!0)};MOD3.VertexCopperlicht.prototype.setZ=function(a){this.vertex.Pos.Z=a;this.buffer.update(!0)};MOD3.MeshCopperlicht=function(){};MOD3.MeshCopperlicht.prototype=new MOD3.MeshProxy;
MOD3.MeshCopperlicht.prototype.setMesh=function(a){MOD3.MeshProxy.prototype.setMesh.call(this,a);for(var a=this.mesh.getMesh().GetMeshBuffers(),b=[],c=0;c<a.length;c++)for(var b=a[c].Vertices,d=b.length,f=0;f<d;f++){var e=new MOD3.VertexCopperlicht(this.mesh,a[c]);e.setVertex(b[f]);this.vertices.push(e)}this.faces=null;delete lookup};MOD3.MeshCopperlicht.prototype.updateMeshPosition=function(a){this.mesh.Pos.X+=a.x;this.mesh.Pos.Y+=a.y;this.mesh.Pos.Z+=a.z};
